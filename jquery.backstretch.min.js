/*
 * jQuery Backstretch
 * Version 1.3
 * http://srobbin.com/jquery-plugins/jquery-backstretch/
 *
 * Add a dynamically-resized background image to the page
 *
 * Copyright (c) 2011 Scott Robbin (srobbin.com)
 * Dual licensed under the MIT and GPL licenses.
 *
 * modified 2012-01-26 by Dan Millar (@danmillar)
 * added ability to call backstretch on other elements
*/
;(function($){$.fn.backstretch=function(src,options,callback){return this.each(function(i){var defaultSettings={centeredX:true,centeredY:true,speed:0},el=$(this),isBody=(el.get(0).tagName==undefined)?true:false,container=isBody?$(".backstretch"):el.find(".backstretch"),settings=container.data("settings")||defaultSettings,existingSettings=container.data("settings'"),imgRatio,bgImg,bgWidth,bgHeight,bgOffset,bgCSS;if(options&&typeof options=="object")$.extend(settings,options);if(options&&typeof options=="function")callback=options;$(document).ready(_3);return this;function _3(){if(src){var img;if(!isBody){el.css({position:"relative",background:"none"})}if(container.length==0){container=$("<div />").attr("class","backstretch").css({left:0,top:0,position:(isBody?"fixed":"absolute"),overflow:"hidden",zIndex:(isBody?-999999:-999998),margin:0,padding:0,height:"100%",width:"100%"})}else{container.find("img").addClass("deleteable")}img=$("<img />").css({position:"absolute",display:"none",margin:0,padding:0,border:"none",zIndex:-999999}).bind("load",function(e){var self=$(this),imgWidth,imgHeight;self.css({width:"auto",height:"auto"});imgWidth=this.width||$(e.target).width();imgHeight=this.height||$(e.target).height();imgRatio=imgWidth/imgHeight;_1(function(){self.fadeIn(settings.speed,function(){container.find('.deleteable').remove();if(typeof callback=="function")callback()})})}).appendTo(container);if(el.children(".backstretch").length==0){if(isBody){$('body').append(container)}else{el.append(container)}}container.data("settings",settings);img.attr("src",src);$(window).resize(_1)}}function _1(fn){try{bgCSS={left:0,top:0};bgWidth=_2();bgHeight=bgWidth/imgRatio;if(bgHeight>=_0()){bgOffset=(bgHeight-_0())/2;if(settings.centeredY)$.extend(bgCSS,{top:"-"+bgOffset+"px"})}else{bgHeight=_0();bgWidth=bgHeight*imgRatio;bgOffset=(bgWidth-_2())/2;if(settings.centeredX)$.extend(bgCSS,{left:"-"+bgOffset+"px"})}container.children("img:not(.deleteable)").width(bgWidth).height(bgHeight).filter("img").css(bgCSS)}catch(err){}if(typeof fn=="function")fn()}function _2(){return isBody?el.width():el.outerWidth()}function _0(){return isBody?el.height():el.outerHeight()}})};$.backstretch=function(src,options,callback){var el=("onorientationchange"in window)?$(document):$(window);el.backstretch(src,options,callback)}})(jQuery);